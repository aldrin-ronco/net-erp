<UserControl x:Class="NetErp.Books.AccountingEntities.Views.AccountingEntityDetailView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:NetErp.Books.AccountingEntities.Views"
             xmlns:h="clr-namespace:NetErp.Helpers"
             xmlns:dxmvvm="http://schemas.devexpress.com/winfx/2008/xaml/mvvm"
             xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core"
             xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
             xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"
             xmlns:busyIndicator="https://github.com/moh3ngolshani/BusyIndicator"
             xmlns:cal="http://caliburnmicro.com"
             xmlns:config="clr-namespace:Common.Config;assembly=Common"
             mc:Ignorable="d"
             d:DesignWidth="900" FontSize="13">
    <UserControl.Resources>
        <h:BindingProxy x:Key="DataContextProxy" Data="{Binding}"/>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <h:SimpleBooleanConverter x:Key="SimpleBooleanConverter" True="False" False="True"/>
        <h:EnumBooleanConverter x:Key="EnumBooleanConverter"/>
    </UserControl.Resources>

    <busyIndicator:BusyMask x:Name="BusyIndicator"
                            IsBusy="{Binding IsBusy}"
                            IndicatorType="BouncingDot"
                            BusyContent="Please wait..."
                            BusyContentMargin="0,20,0,0"
                            IsBusyAtStartup="False">
        <Border Background="White" BorderBrush="#D9DDE3" BorderThickness="1"
                CornerRadius="8" Margin="10">
            <Grid h:EnterKeyTraversal.IsEnabled="True">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Row 0: Header section (Régimen, Tipo Documento, Número, Tipo Captura) -->
                <Grid Grid.Row="0" Margin="20,15,20,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Régimen -->
                    <TextBlock Grid.Column="0" Grid.Row="0" Text="Régimen" VerticalAlignment="Center" Margin="0,0,10,8"/>
                    <ComboBox Grid.Column="1" Grid.Row="0"
                              VerticalAlignment="Center" Margin="0,0,0,8" Padding="3"
                              IsEnabled="{Binding IsNewRecord, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                              x:Name="RegimeDictionary"
                              DisplayMemberPath="Value"
                              SelectedValuePath="Key"
                              SelectedValue="{Binding Path=SelectedRegime, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                        <ComboBox.ItemsPanel>
                            <ItemsPanelTemplate>
                                <VirtualizingStackPanel/>
                            </ItemsPanelTemplate>
                        </ComboBox.ItemsPanel>
                    </ComboBox>

                    <!-- Tipo de Documento -->
                    <TextBlock Grid.Column="0" Grid.Row="1" Text="Tipo de Documento" VerticalAlignment="Center" Margin="0,0,10,8"/>
                    <ComboBox Grid.Column="1" Grid.Row="1"
                              VerticalAlignment="Center" Margin="0,0,0,8" Padding="3"
                              x:Name="IdentificationTypes"
                              DisplayMemberPath="Name"
                              SelectedValuePath="Id"
                              IsEnabled="{Binding IsNewRecord, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                              SelectedItem="{Binding Path=SelectedIdentificationType, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

                    <!-- Número de documento -->
                    <TextBlock Grid.Column="0" Grid.Row="2" Text="Número" VerticalAlignment="Center" Margin="0,0,10,8"/>
                    <StackPanel Orientation="Horizontal" Grid.Column="1" Grid.Row="2" Margin="0,0,0,8">
                        <dxe:SpinEdit x:Name="IdentificationNumber"
                                      Width="Auto" MinWidth="60"
                                      Padding="3"
                                      MaskType="Numeric"
                                      MinValue="0"
                                      Mask="n0"
                                      AllowDefaultButton="False"
                                      dxe:NumericMaskOptions.AlwaysShowDecimalSeparator="False"
                                      dxe:NumericMaskOptions.HideInsignificantZeros="True"
                                      MaxLength="15"
                                      VerticalContentAlignment="Center"
                                      h:FocusBehavior.IsFocused="{Binding IdentificationNumberIsFocused, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                      IsReadOnly="{Binding IsNewRecord, Mode=OneWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource SimpleBooleanConverter}}"/>
                        <TextBox Width="20" Margin="6,0,0,0"
                                 Text="{Binding Path=VerificationDigit, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                                 IsReadOnly="True"
                                 IsTabStop="False"
                                 VerticalContentAlignment="Center"
                                 Visibility="{Binding SelectedIdentificationType.HasVerificationDigit,
                                              Mode=OneWay, UpdateSourceTrigger=PropertyChanged, Converter={dx:BooleanToVisibilityConverter}}"
                                 HorizontalContentAlignment="Center"/>
                    </StackPanel>

                    <!-- Tipo de Captura -->
                    <TextBlock Grid.Column="0" Grid.Row="3" Text="Tipo de captura" VerticalAlignment="Center" Margin="0,0,10,0"/>
                    <StackPanel Orientation="Horizontal" Grid.Column="1" Grid.Row="3" VerticalAlignment="Center">
                        <RadioButton Content="Persona Natural"
                                     GroupName="CaptureType"
                                     IsChecked="{Binding SelectedCaptureType, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged,
                                     Converter={StaticResource EnumBooleanConverter}, ConverterParameter=PN}"/>
                        <RadioButton Content="Persona Jurídica"
                                     GroupName="CaptureType"
                                     IsChecked="{Binding SelectedCaptureType, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged,
                                     Converter={StaticResource EnumBooleanConverter}, ConverterParameter=PJ}"
                                     Margin="10,0,0,0"/>
                    </StackPanel>
                </Grid>

                <!-- Row 1: Tab control -->
                <dx:DXTabControl Grid.Row="1" Margin="20,10,20,0" Padding="8"
                                 TabContentCacheMode="CacheTabsOnSelecting"
                                 SelectedIndex="{Binding Path=SelectedIndexPage, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">

                    <!-- Tab: Datos Básicos -->
                    <dx:DXTabItem Header="Datos Básicos">
                        <Grid Margin="5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Razón Social (PJ) -->
                            <TextBlock Text="Razón Social"
                                       Grid.Column="0" Grid.Row="0"
                                       Visibility="{Binding CaptureInfoAsPJ, Mode=OneWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource BooleanToVisibilityConverter}}"
                                       Margin="0,4,4,2"/>
                            <dxe:TextEdit x:Name="BusinessName"
                                          CharacterCasing="Upper"
                                          Visibility="{Binding CaptureInfoAsPJ, Mode=OneWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource BooleanToVisibilityConverter}}"
                                          Grid.Column="0" Grid.ColumnSpan="4" Grid.Row="1"
                                          Margin="0,0,0,0" Padding="3"
                                          BorderBrush="#C8CED6"
                                          h:FocusBehavior.IsFocused="{Binding BusinessNameIsFocused, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

                            <!-- Primer Nombre (PN) -->
                            <TextBlock Text="Primer Nombre"
                                       Grid.Column="0" Grid.Row="2"
                                       Visibility="{Binding CaptureInfoAsPN, Mode=OneWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource BooleanToVisibilityConverter}}"
                                       Margin="0,4,4,2"/>
                            <dxe:TextEdit x:Name="FirstName"
                                          CharacterCasing="Upper"
                                          Grid.Column="0" Grid.Row="3"
                                          Visibility="{Binding CaptureInfoAsPN, Mode=OneWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource BooleanToVisibilityConverter}}"
                                          Margin="0,0,4,0" Padding="3"
                                          BorderBrush="#C8CED6"
                                          h:FocusBehavior.IsFocused="{Binding FirstNameIsFocused, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

                            <!-- Segundo Nombre (PN) -->
                            <TextBlock Text="Segundo Nombre"
                                       Grid.Column="1" Grid.Row="2"
                                       Visibility="{Binding CaptureInfoAsPN, Mode=OneWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource BooleanToVisibilityConverter}}"
                                       Margin="4,4,4,2"/>
                            <dxe:TextEdit x:Name="MiddleName"
                                          CharacterCasing="Upper"
                                          Grid.Column="1" Grid.Row="3"
                                          Visibility="{Binding CaptureInfoAsPN, Mode=OneWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource BooleanToVisibilityConverter}}"
                                          Margin="4,0,4,0" Padding="3"
                                          BorderBrush="#C8CED6"/>

                            <!-- Primer Apellido (PN) -->
                            <TextBlock Text="Primer Apellido"
                                       Grid.Column="2" Grid.Row="2"
                                       Visibility="{Binding CaptureInfoAsPN, Mode=OneWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource BooleanToVisibilityConverter}}"
                                       Margin="4,4,4,2"/>
                            <dxe:TextEdit x:Name="FirstLastName"
                                          CharacterCasing="Upper"
                                          Grid.Column="2" Grid.Row="3"
                                          Visibility="{Binding CaptureInfoAsPN, Mode=OneWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource BooleanToVisibilityConverter}}"
                                          Margin="4,0,4,0" Padding="3"
                                          BorderBrush="#C8CED6"/>

                            <!-- Segundo Apellido (PN) -->
                            <TextBlock Text="Segundo Apellido"
                                       Grid.Column="3" Grid.Row="2"
                                       Visibility="{Binding CaptureInfoAsPN, Mode=OneWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource BooleanToVisibilityConverter}}"
                                       Margin="4,4,0,2"/>
                            <dxe:TextEdit x:Name="MiddleLastName"
                                          CharacterCasing="Upper"
                                          Grid.Column="3" Grid.Row="3"
                                          Visibility="{Binding CaptureInfoAsPN, Mode=OneWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource BooleanToVisibilityConverter}}"
                                          Margin="4,0,0,0" Padding="3"
                                          BorderBrush="#C8CED6"/>

                            <!-- Nombre Comercial (PN) -->
                            <TextBlock Text="Nombre Comercial"
                                       Grid.Column="0" Grid.Row="4"
                                       Visibility="{Binding CaptureInfoAsPN, Mode=OneWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource BooleanToVisibilityConverter}}"
                                       Margin="0,4,4,2"/>
                            <dxe:TextEdit x:Name="TradeName"
                                          CharacterCasing="Upper"
                                          Grid.Column="0" Grid.ColumnSpan="4" Grid.Row="5"
                                          Visibility="{Binding CaptureInfoAsPN, Mode=OneWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource BooleanToVisibilityConverter}}"
                                          Margin="0,0,0,0" Padding="3"
                                          BorderBrush="#C8CED6"/>

                            <!-- Teléfono Fijo No. 1 -->
                            <TextBlock Text="Teléfono Fijo No. 1"
                                       Grid.Column="0" Grid.Row="6" Margin="0,4,4,2"/>
                            <dxe:TextEdit x:Name="PrimaryPhone"
                                          MaxLength="10" MaskType="Simple" Mask="000 00 00"
                                          Grid.Column="0" Grid.Row="7"
                                          cal:Message.Attach="[Event LostFocus] = [Action PhoneInputLostFocus($source)]"
                                          Margin="0,0,4,0" Padding="3"
                                          BorderBrush="#C8CED6"
                                          Validation.ErrorTemplate="{x:Null}"/>

                            <!-- Teléfono Fijo No. 2 -->
                            <TextBlock Text="Teléfono Fijo No. 2"
                                       Grid.Column="1" Grid.Row="6" Margin="4,4,4,2"/>
                            <dxe:TextEdit x:Name="SecondaryPhone"
                                          MaxLength="10" MaskType="Simple" Mask="000 00 00"
                                          Grid.Column="1" Grid.Row="7"
                                          cal:Message.Attach="[Event LostFocus] = [Action PhoneInputLostFocus($source)]"
                                          Margin="4,0,4,0" Padding="3"
                                          BorderBrush="#C8CED6"
                                          Validation.ErrorTemplate="{x:Null}"/>

                            <!-- Teléfono Celular No. 1 -->
                            <TextBlock Text="Teléfono Celular No. 1"
                                       Grid.Column="2" Grid.Row="6" Margin="4,4,4,2"/>
                            <dxe:TextEdit x:Name="PrimaryCellPhone"
                                          MaxLength="14" MaskType="Simple" Mask="000 000 00 00"
                                          Grid.Column="2" Grid.Row="7"
                                          cal:Message.Attach="[Event LostFocus] = [Action PhoneInputLostFocus($source)]"
                                          Margin="4,0,4,0" Padding="3"
                                          BorderBrush="#C8CED6"
                                          Validation.ErrorTemplate="{x:Null}"/>

                            <!-- Teléfono Celular No. 2 -->
                            <TextBlock Text="Teléfono Celular No. 2"
                                       Grid.Column="3" Grid.Row="6" Margin="4,4,0,2"/>
                            <dxe:TextEdit x:Name="SecondaryCellPhone"
                                          MaxLength="14" MaskType="Simple" Mask="000 000 00 00"
                                          Grid.Column="3" Grid.Row="7"
                                          cal:Message.Attach="[Event LostFocus] = [Action PhoneInputLostFocus($source)]"
                                          Margin="4,0,0,0" Padding="3"
                                          BorderBrush="#C8CED6"
                                          Validation.ErrorTemplate="{x:Null}"/>

                            <!-- País, Departamento, Municipio -->
                            <Grid Grid.Column="0" Grid.ColumnSpan="4" Grid.Row="8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- País -->
                                <TextBlock Text="País"
                                           Grid.Column="0" Grid.Row="0" Margin="0,4,4,2"/>
                                <dxg:LookUpEdit Grid.Column="0" Grid.Row="1"
                                                Margin="0,0,4,0" Padding="3"
                                                AllowSpin="True"
                                                AutoPopulateColumns="False"
                                                IsCaseSensitiveSearch="False"
                                                IncrementalFiltering="True"
                                                IncrementalSearch="True"
                                                ValidateOnTextInput="False"
                                                FilterCondition="Contains"
                                                ImmediatePopup="True"
                                                ClearSelectionOnBackspace="True"
                                                ItemsSource="{Binding Path=Countries, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                                                DisplayMember="Name"
                                                ValueMember="Id"
                                                SelectedItem="{Binding Path=SelectedCountry, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                    <dxg:LookUpEdit.PopupContentTemplate>
                                        <ControlTemplate>
                                            <dxg:GridControl Name="PART_GridControl">
                                                <dxg:GridControl.View>
                                                    <dxg:TableView AutoWidth="True"/>
                                                </dxg:GridControl.View>
                                                <dxg:GridControl.Columns>
                                                    <dxg:GridColumn Header="Nombre del país" FieldName="Name"/>
                                                </dxg:GridControl.Columns>
                                            </dxg:GridControl>
                                        </ControlTemplate>
                                    </dxg:LookUpEdit.PopupContentTemplate>
                                    <dxg:LookUpEdit.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <VirtualizingStackPanel/>
                                        </ItemsPanelTemplate>
                                    </dxg:LookUpEdit.ItemsPanel>
                                </dxg:LookUpEdit>

                                <!-- Departamento -->
                                <TextBlock Text="Departamento"
                                           Grid.Column="1" Grid.Row="0" Margin="4,4,4,2"/>
                                <dxg:LookUpEdit Grid.Column="1" Grid.Row="1"
                                                Margin="4,0,4,0" Padding="3"
                                                ItemsSource="{Binding Path=SelectedCountry.Departments, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                                                IsCaseSensitiveSearch="False"
                                                AutoPopulateColumns="False"
                                                IsCaseSensitiveFilter="False"
                                                CharacterCasing="Upper"
                                                FilterCondition="Contains"
                                                ImmediatePopup="True"
                                                ClearSelectionOnBackspace="True"
                                                DisplayMember="Name"
                                                ValueMember="Id"
                                                SelectedItem="{Binding SelectedDepartment, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                    <dxg:LookUpEdit.PopupContentTemplate>
                                        <ControlTemplate>
                                            <dxg:GridControl Name="PART_GridControl">
                                                <dxg:GridControl.View>
                                                    <dxg:TableView AllowCascadeUpdate="True" ShowSearchPanelMode="Never" AutoWidth="True"/>
                                                </dxg:GridControl.View>
                                                <dxg:GridControl.Columns>
                                                    <dxg:GridColumn Header="Nombre del departamento" FieldName="Name"/>
                                                </dxg:GridControl.Columns>
                                            </dxg:GridControl>
                                        </ControlTemplate>
                                    </dxg:LookUpEdit.PopupContentTemplate>
                                    <dxg:LookUpEdit.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <VirtualizingStackPanel/>
                                        </ItemsPanelTemplate>
                                    </dxg:LookUpEdit.ItemsPanel>
                                </dxg:LookUpEdit>

                                <!-- Municipio -->
                                <TextBlock Text="Municipio"
                                           Grid.Column="2" Grid.Row="0" Margin="4,4,0,2"/>
                                <dxg:LookUpEdit Grid.Column="2" Grid.Row="1"
                                                Margin="4,0,0,0" Padding="3"
                                                ClearSelectionOnBackspace="True"
                                                ItemsSource="{Binding Path=SelectedDepartment.Cities, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                                                FilterCondition="Contains"
                                                IsCaseSensitiveFilter="False"
                                                AutoPopulateColumns="False"
                                                CharacterCasing="Upper"
                                                ImmediatePopup="True"
                                                DisplayMember="Name"
                                                ValueMember="Id"
                                                EditValue="{Binding SelectedCityId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                    <dxg:LookUpEdit.PopupContentTemplate>
                                        <ControlTemplate>
                                            <dxg:GridControl Name="PART_GridControl">
                                                <dxg:GridControl.View>
                                                    <dxg:TableView AllowCascadeUpdate="True" ShowSearchPanelMode="Never" AutoWidth="True"/>
                                                </dxg:GridControl.View>
                                                <dxg:GridControl.Columns>
                                                    <dxg:GridColumn Header="Nombre del municipio" FieldName="Name"/>
                                                </dxg:GridControl.Columns>
                                            </dxg:GridControl>
                                        </ControlTemplate>
                                    </dxg:LookUpEdit.PopupContentTemplate>
                                    <dxg:LookUpEdit.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <VirtualizingStackPanel/>
                                        </ItemsPanelTemplate>
                                    </dxg:LookUpEdit.ItemsPanel>
                                </dxg:LookUpEdit>
                            </Grid>

                            <!-- Dirección -->
                            <TextBlock Text="Dirección"
                                       Grid.Column="0" Grid.Row="9" Margin="0,4,0,2"/>
                            <dxe:TextEdit x:Name="Address"
                                          Grid.Column="0" Grid.ColumnSpan="4" Grid.Row="10"
                                          Margin="0" Padding="3"
                                          BorderBrush="#C8CED6"/>
                        </Grid>
                    </dx:DXTabItem>

                    <!-- Tab: Otros Datos -->
                    <dx:DXTabItem Header="Otros Datos"/>

                    <!-- Tab: Emails -->
                    <dx:DXTabItem Header="Emails">
                        <Grid Margin="5">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <Grid Grid.Row="0">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Descripción" Grid.Column="0" Grid.Row="0" Margin="4,0,0,2"/>
                                <TextBlock Text="Email" Grid.Column="1" Grid.Row="0" Margin="4,0,0,2"/>
                                <TextBox x:Name="EmailDescription"
                                         Text="{Binding Path=EmailDescription, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         Grid.Column="0" Grid.Row="1" Margin="4" Padding="4" FontSize="14"/>
                                <TextBox Text="{Binding Path=Email, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         Grid.Column="1" Grid.Row="1" Margin="4" Padding="4" FontSize="14"/>
                                <Button Grid.Column="2" Grid.Row="1" Margin="4" Padding="4" x:Name="AddEmail">
                                    <Image Source="{dx:DXImage 'Images/Actions/Add_16x16.png'}" Stretch="None">
                                        <Image.Style>
                                            <Style TargetType="Image">
                                                <Style.Triggers>
                                                    <Trigger Property="IsEnabled" Value="False">
                                                        <Setter Property="Opacity" Value=".5"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Image.Style>
                                    </Image>
                                </Button>
                            </Grid>

                            <DataGrid Grid.Row="1" Margin="4"
                                      AutoGenerateColumns="False"
                                      VerticalGridLinesBrush="LightGray"
                                      HorizontalGridLinesBrush="LightGray"
                                      BorderThickness="0"
                                      CanUserAddRows="False"
                                      SelectionMode="Single"
                                      SelectionUnit="FullRow"
                                      MinRowHeight="30"
                                      AlternatingRowBackground="Beige"
                                      Background="Transparent"
                                      CanUserDeleteRows="False"
                                      cal:Message.Attach="[Event CellEditEnding] = [Action EndRowEditing]"
                                      ItemsSource="{Binding Path=Emails, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                                      SelectedItem="{Binding Path=SelectedEmail, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                <DataGrid.Columns>
                                    <!-- Descripción -->
                                    <DataGridTemplateColumn Header="Descripción" Width="1*">
                                        <DataGridTemplateColumn.HeaderStyle>
                                            <Style TargetType="{x:Type DataGridColumnHeader}">
                                                <Setter Property="HorizontalContentAlignment" Value="Left"/>
                                            </Style>
                                        </DataGridTemplateColumn.HeaderStyle>
                                        <DataGridTemplateColumn.CellStyle>
                                            <Style TargetType="DataGridCell">
                                                <Setter Property="HorizontalAlignment" Value="Stretch"/>
                                                <Setter Property="VerticalAlignment" Value="Stretch"/>
                                                <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
                                                <Setter Property="BorderThickness" Value="0"/>
                                            </Style>
                                        </DataGridTemplateColumn.CellStyle>
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Path=Description, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                                                           TextWrapping="Wrap" VerticalAlignment="Center" Padding="3"/>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                        <DataGridTemplateColumn.CellEditingTemplate>
                                            <DataTemplate>
                                                <TextBox Text="{Binding Path=Description, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                         VerticalAlignment="Center" Padding="3"/>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellEditingTemplate>
                                    </DataGridTemplateColumn>

                                    <!-- Email -->
                                    <DataGridTemplateColumn Header="Email" Width="1*">
                                        <DataGridTemplateColumn.HeaderStyle>
                                            <Style TargetType="{x:Type DataGridColumnHeader}">
                                                <Setter Property="HorizontalContentAlignment" Value="Left"/>
                                            </Style>
                                        </DataGridTemplateColumn.HeaderStyle>
                                        <DataGridTemplateColumn.CellStyle>
                                            <Style TargetType="DataGridCell">
                                                <Setter Property="HorizontalAlignment" Value="Stretch"/>
                                                <Setter Property="VerticalAlignment" Value="Stretch"/>
                                                <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
                                                <Setter Property="BorderThickness" Value="0"/>
                                            </Style>
                                        </DataGridTemplateColumn.CellStyle>
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Path=Email, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                                                           TextWrapping="Wrap" VerticalAlignment="Center" Padding="3"/>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                        <DataGridTemplateColumn.CellEditingTemplate>
                                            <DataTemplate>
                                                <TextBox Text="{Binding Path=Email, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                         VerticalAlignment="Center"/>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellEditingTemplate>
                                    </DataGridTemplateColumn>

                                    <!-- Delete Button -->
                                    <DataGridTemplateColumn Width="40">
                                        <DataGridTemplateColumn.CellStyle>
                                            <Style TargetType="DataGridCell">
                                                <Setter Property="HorizontalAlignment" Value="Stretch"/>
                                                <Setter Property="VerticalAlignment" Value="Stretch"/>
                                                <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
                                                <Setter Property="BorderThickness" Value="0"/>
                                            </Style>
                                        </DataGridTemplateColumn.CellStyle>
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <Button Margin="4" Padding="4"
                                                        Command="{Binding Data.DeleteMailCommand, Source={StaticResource DataContextProxy}}">
                                                    <Image Source="{dx:DXImage 'Images/Actions/Trash_16x16.png'}" Stretch="None" Margin="3,0,3,0"/>
                                                </Button>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                </DataGrid.Columns>
                            </DataGrid>
                        </Grid>
                    </dx:DXTabItem>
                </dx:DXTabControl>

                <!-- Row 2: Action buttons centered -->
                <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10,0,20">
                    <!-- Regresar -->
                    <Button Background="Transparent" BorderThickness="0" Padding="15,5" Cursor="Hand"
                            Command="{Binding Path=GoBackCommand}">
                        <StackPanel HorizontalAlignment="Center">
                            <Image Source="{dx:DXImage 'Images/Navigation/Backward_32x32.png'}" Width="32" Height="32" HorizontalAlignment="Center"/>
                            <TextBlock Text="Regresar" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                        </StackPanel>
                    </Button>
                    <!-- Guardar -->
                    <Button Background="Transparent" BorderThickness="0" Padding="15,5" Cursor="Hand"
                            IsEnabled="{Binding CanSave, UpdateSourceTrigger=PropertyChanged}">
                        <dxmvvm:Interaction.Behaviors>
                            <dxmvvm:EventToCommand Command="{Binding SaveCommand}" EventName="Click"/>
                        </dxmvvm:Interaction.Behaviors>
                        <StackPanel HorizontalAlignment="Center">
                            <Image Source="{dx:DXImage 'Images/Save/Save_32x32.png'}" Width="32" Height="32" HorizontalAlignment="Center">
                                <Image.Style>
                                    <Style TargetType="Image">
                                        <Style.Triggers>
                                            <Trigger Property="IsEnabled" Value="False">
                                                <Setter Property="Opacity" Value="0.4"/>
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </Image.Style>
                            </Image>
                            <TextBlock Text="Guardar" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
    </busyIndicator:BusyMask>
</UserControl>
